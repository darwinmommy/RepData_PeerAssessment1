#Course Project- Week 2
###Coursera- Reproducible Research 
Meredith C Henderson


###Preparation: Download the data and unzip the file contents.

```{r}
Filename<-"Activity.zip"
if(!file.exists(Filename)){
    Url<-"https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
    download.file(Url,Filename)
}

if(!file.exists("Activity_Data")){
    unzip(Filename,exdir="Activity_Data")
}
```


###Part 1: Load the data using read.csv(). Convert the "date" variable from factor to date format and the "steps" variable to numeric, I'm using str() before and after to confirm the conversion.
```{r setup}
activity<-read.csv("./Activity_Data/activity.csv")
str(activity)
activity$date<-as.Date(as.factor(activity$date))
activity$steps<-as.numeric(activity$steps)
str(activity)
```


###Part 2: Create a histogram that shows the total number of steps taken per day. The x-axis shows a number range that represents the total number of steps taken in a day. The y-axis shows how many days had totals that fell within that range.  
```{r,fig.align="center"}
plot1<-with(activity,tapply(steps,list(date), FUN = sum))
hist(plot1, col="cyan3",
     xlab="Steps", main="Total Steps Taken Per Day")
```


###Part 3: Create a table showing the mean and median steps taken per day.  I'm using the "kableExtra" package, which is similar to "knitr" but allows for more customization. 
```{r}
library(data.table)
DT<-data.table(activity, key="date")
DT2<-DT[,c("Mean","Median"):= list(mean(steps[steps!=0]), median(steps[steps!=0])), by=list(date)]
DT2<-DT[,list(Mean=mean(steps[steps!=0]), Median=median(steps[steps!=0])), by=list(date)]
library(kableExtra)
kable(DT2, align = "c") %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = F) %>%
    column_spec(1, width = "8em", border_left = T, border_right = T) %>%
    column_spec(2, width = "12em", border_right = T) %>%
    column_spec(3, width= "8em", border_right = T)
```


###Part 4: Create a time series plot of the average steps taken per day. The NA values were not removed for this plot; the gaps in the line are expected.
```{r,fig.pos="p",fig.width=10}
plot(DT2$Mean~as.Date(DT2$date), type="l", 
     ylab= "Average steps", xlab= "Date", 
     main= "Time Series of Average Steps Taken Per Day")
```


###Part 5: Determine which interval has the most steps per day on average, the table generated by this code will show the top 10 in descending order. From the table output, we can see that interval 835 has the highest average steps per day.
```{r}
library(data.table)
DT_Int<-data.table(activity, key="interval", na.rm=T)
DT3<-DT_Int[,c("Mean","Median"):= list(mean(steps[steps!=0], na.rm=T), median(steps[steps!=0], na.rm=T)), by=list(interval)]
DT3<-DT3[,list(Mean=mean(steps[steps!=0], na.rm=T), Median=median(steps[steps!=0], na.rm=T)), by=list(interval)]
DT4<-DT3[order(-Mean)]
DT4<-DT4[1:10,1:2]
library(kableExtra)
kable(DT4, align = "c") %>%
    kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = F) %>%
    column_spec(1, width= "8em", border_left = T, border_right = T) %>%
    column_spec(2, width= "10em", border_right = T)
```


###Part 6: Impute missing (NA) values. We can see from the call to summary() that there are 2304 NA values.  The code below will search for NA values in the "steps" variable and replace with the average number of steps for the corresponding interval.  We can double check this by recreating the table from Part 4 and comparing the values. We can see in the table below that all NA values have been replaced.
```{r}
summary(activity)
activity2<-data.frame(activity)
activity2$steps<-with(activity2,ave(steps,interval,FUN = function(x) replace(x,is.na(x), mean(x,na.rm=T))))
DT<-data.table(activity2, key="date")
DT2<-DT[,c("Mean","Median"):= list(mean(steps[steps!=0]), median(steps[steps!=0])), by=list(date)]
DT2<-DT[,list(Mean=mean(steps[steps!=0]), Median=median(steps[steps!=0])), by=list(date)]
library(kableExtra)
kable(DT2, align = "c") %>%
  kable_styling(bootstrap_options = c("striped","hover","condensed"), full_width = F) %>%
    column_spec(1, width = "8em", border_left = T, border_right = T) %>%
    column_spec(2, width = "12em", border_right = T) %>%
    column_spec(3, width= "8em", border_right = T)
```


###Part 7: Plot a histogram showing total steps taken per day after missing values have been imputed. This code is the same as above, but the plot is shown in a different color (the y-axis for the first plot has been adjusted here to match that of the second plot). When we compare the first plot (left) with missing values to the second plot (right) with the NA values imputed, we can see that the middle bar (10,000-15,000 total steps) has increased, but all other appear to remain the same. This means that all days that had previously only had NA values now have a total number of steps consistent with the middle of the normal distribution.
```{r,fig.align="center"}
par(mfrow=c(1,2))
plot1<-with(activity,tapply(steps,list(date), FUN = sum))
hist(plot1, col="cyan3", ylim = c(0,35),
     xlab="Steps", main="Total Steps Per Day \nWith NAs")
plot2<-with(activity2,tapply(steps,list(date), FUN = sum))
hist(plot2, col="coral",
     xlab="Steps", main="Total Steps Per Day \nNAs Imputed")
```


###Part 8: Create a panel plot comparing the average number of steps taken per 5-minute interval across weekdays and weekends. I chose to use the isWeekday() and isWeekend() functions from the "timeDate" package. Separate datasets were created for weekdays and weekends, then plotted as line graphs. When comparing the graphs, we can see that weekdays tend to have a higher average number of steps in early intervals, which shift toward later intervals on the weekends. This would be consistent with high levels of activity in the early morning on work/school days and sleeping in/staying up late on weekends.
```{r,fig.width=6,fig.height=8,fig.align="center"}
library(data.table)
DT<-data.table(activity2, key="interval")
library(timeDate)
DT5<-DT[isWeekday(DT$date),]
DT5<-DT5[,c("Mean","Median"):= list(mean(steps[steps!=0]), median(steps[steps!=0])), by=list(interval)]
DT5<-DT5[,list(Mean=mean(steps[steps!=0]), Median=median(steps[steps!=0])), by=list(interval)]
DT6<-DT[isWeekend(DT$date),]
DT6<-DT6[,c("Mean","Median"):= list(mean(steps[steps!=0]), median(steps[steps!=0])), by=list(interval)]
DT6<-DT6[,list(Mean=mean(steps[steps!=0]), Median=median(steps[steps!=0])), by=list(interval)]
par(mfrow=c(2,1))
plot(DT5$Mean~DT5$interval, type="l", col= "indianred",
     ylab= "Average steps", xlab= "Interval", 
     main= "Average Steps Taken Per Interval - Weekdays")
plot(DT6$Mean~DT6$interval, type="l", 
     ylab= "Average steps", xlab= "Interval", col="darkblue", 
     main= "Average Steps Taken Per Interval - Weekends")
```